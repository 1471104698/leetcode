# IP 相关知识



## 网络层（IP） 和 数据链路层（MAC） 的关系

**MAC 的作用则是实现「直连」的两个设备之间通信，而 IP 则负责在「没有直连」的两个网络之间进行通信传输。**

比如假设你要从 广东到北京，这是 IP 源地址 和 IP 目的地址，但是不可能直接就从 广东 到 北京

你需要路程表，需要先到哪里再到哪里，最后到达北京，需要 直连的点与点 之间的通信移动

比如从 广东 到 福建，福建到 黑龙江，黑龙江到北京， 这一个个直连的点，就是 MAC 之间的通信（应该是路由器之间的通信 和 数据传输）

旅行途中我们虽然不断变化了交通工具，但是旅行行程的起始地址和目的地址始终都没变。其实，在网络中数据包传输中也是如此，**源IP地址和目标IP地址在传输过程中是不会变化的，只有源 MAC 地址和目标 MAC 一直在变化。**



## IP地址划分

首先，最基础的当然就是 IP 地址是怎么划分的啦

首先我们需要知道 IP 地址的数量

以 IPv4 为例，每个 IP 由 32 位二进制组成，这里没有负数的概念，因此总的有 42 亿 IP 地址

*![image.png](https://pic.leetcode-cn.com/1598011080-gucfqx-image.png)*



常用划分为 A、B、C 类

各类的网络号和主机号位数不同，因为都是 32 位，因此网络号位数多的主机号位数就少

划分出网络号的目的是为了方便数据传输，路由器可以根据 IP 目的地址的网络号 确定是哪个网络段的来进行传输

*![image.png](https://pic.leetcode-cn.com/1598011098-zyTTOy-image.png)*

*![image.png](https://pic.leetcode-cn.com/1598010654-jidKYZ-image.png)*



一般我们自己电脑下的就是 C 类地址，以 192.x.x.x 的

*![image.png](https://pic.leetcode-cn.com/1598011333-DtpXyL-image.png)*



## 划分子网 - 子网掩码

**就比如我们上面说的，为什么要划分出网络号和主机号，网络号的作用是什么？**

两台计算机要通信，首先要判断是否在同一个网络段，如果是，那么直接发送数据包到目的主机，如果不是，那么通过 路由器寻址，通过网络号来寻找对应的网络段位置

![1598011512649](C:\Users\蒜头王八\AppData\Roaming\Typora\typora-user-images\1598011512649.png)



#### **子网掩码：**

掩码的意思就是掩盖掉主机号，剩余的就是网络号，即将主机号和网络号进行分离

由于我们要掩盖掉主机号来留下网络号，因此，对于 C 类地址，号码 8 位都是主机号

因此，子网掩码为 255.255.255.0，这样按位与操作后，主机号就都变成 0 了，而 网络号不变

*![image.png](https://pic.leetcode-cn.com/1598011628-yKmTMc-image.png)*



同样的，如果是 B 类地址，那么后 16 位为主机号，那么子网掩码为 255.255.0.0





## DNS

使用域名的主要原因就是方便用户记忆，不然你每次都输入一串 IP 地址去访问，这样多麻烦

输入 访问 url 后，需要先通过 DNS 域名解析，获取到 目的 IP 地址，才能进行 TCP/UDP 通信

 

由于域名是国外发明的，而国外的习惯跟我们不同，  习惯从小到大，而我们习惯从大到小

外国喜欢从小到大的方式顺序说起（如 XX 街道 XX 区 XX 市 XX 省）

而中国则喜欢从大到小的顺序（如 XX 省 XX 市 XX 区 XX 街道）。



因此域名也是如此，比如 www.server.com。 一般我们认为前面的是大的，但是根据外国的习惯

com 是最高级的，server.com 次之

因此存在以下关系：

- 根 DNS 服务器
- 顶级域 DNS 服务器（com）
- 权威 DNS 服务器（server.com）

*![image.png](https://pic.leetcode-cn.com/1598012011-dUDkmu-image.png)*



com 是由顶级域 DNS 服务器管理的，不是由 根DNS 服务器管理的

根 DNS 服务器最高级，每台 DNS 服务器中都有记录 根域 DNS 服务器

同样的，根域 DNS 服务器 也记录了所有 的 DNS 服务器，这样其他 DNS 服务器可以通过访问 根域 DNS 服务器 来获取其他 DNS 服务器的位置



#### **域名解析的工作流程**

当我们输入 url 后，浏览器会看自己缓存中是否存在 域名对应的 IP 地址，如果没有，那么找操作系统缓存要，如果没有，那么找本地 host 文件要，如果还没有，那么就会通过 DNS 服务器查询，具体过程如下：

- 客户端首先会发送一个 DNS 请求给本地 DNS 服务器（点开网络配置可以看到，一般我们是不会配置的，是默认的 DNS 服务器，具体可以看 IP 地址划分那张图，或者自己点开网络配置看），问 www.server.com  的 IP 地址是什么
- 本地 DNS 服务器获取到请求后，如果自己有记录，那么将 IP 地址返回，如果没有，那么找到自己记录的     根 DNS 服务器，询问对应的 IP 地址，“老大， 能告诉我 www.server.com 的 IP 地址吗？”  
- 需要注意的是，根DNS 服务器 并不参与域名解析，但是我们上面说了，根DNS 服务器 存储了所有 DNS 服务器，因此它可以查询出管理 com 的 DNS 服务器，将地址发给 本地 DNS 服务器，（不参与解析，但会指明一条道路）
- 本地 DNS 服务器获取到管理 com 的顶级域名服务器的地址后，发起请问问它：“老二， 你能告诉我 www.server.com  的 IP 地址吗？”
- 顶级域名服务器会告诉 本地 DNS 服务器 管理 server.com 的权威域名服务器地址
- 本地 DNS 获取 权威域名服务器地址，发起请求问：“老三，www.server.com对应的IP是啥呀？”
- 权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。
- 本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。

#### ![1598012683746](C:\Users\蒜头王八\AppData\Roaming\Typora\typora-user-images\1598012683746.png)